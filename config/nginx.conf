worker_processes  4;

error_log  /aircloak/website/log/nginx-error.log;
pid        /aircloak/website/tmp/nginx.pid;

events {
  worker_connections  1024;
  multi_accept on;
}

http {
  include /etc/nginx/mime.types;
  access_log /aircloak/website/log/nginx-access.log;

  sendfile        on;
  #tcp_nopush     on;

  keepalive_timeout  0;
  tcp_nodelay        on;

  gzip  on;
  gzip_disable "MSIE [1-6]\.(?!.*SV1)";

  upstream unicorn {
    server unix:/aircloak/website/tmp/air-rails.sock fail_timeout=0;
  }

  server {
    listen *:8080;
    root /aircloak/website/public;

    location ^~ /assets/ {
      gzip_static on;
      expires max;
      add_header ETag "";
      add_header Cache-Control public;
    }

    try_files $uri/index.html $uri @unicorn;

    # Proxies requests to unicorn (rails)
    location @unicorn {
      proxy_pass http://unicorn;
    }
  }
}
