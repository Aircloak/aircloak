base="`dirname $0`/../.."
test="$base/test"
testgen="$base/test-gen"
tools="`dirname $0`"

tests="`ls $test/$test_prefix-* | xargs -L1 basename`"

mkdir -p $testgen || exit 1

$tools/generate-prefix || exit 1

for test in $tests
do
  cover_dir="$base/.proper/cover-$test"
  echo
  echo "generating test $test"
  $tools/generate-script $test || exit 1
  echo "preparing cover directory for test $test"
  rm -rf "$cover_dir"
  mkdir -p "$cover_dir"
  echo "running test $test"
  rm -rf $base/.proper/data || exit 1
  time $testgen/$test || exit 1
done
