{
  "type": "object",
  "properties": {
    "name": {"type": "string", "minLength": 1},
    "marker": {"type": "string", "minLength": 1, "$comment": "allowed for backward compatibility"},
    "driver": {"type": "string", "minLength": 1},
    "parameters": {"$ref": "#/definitions/parameters"},
    "tables": {"type": "object", "patternProperties": {"^.*$": {"$ref": "#/definitions/table"}}},
    "encoded": {"type": "boolean"},
    "statistics_anonymization": {"type": "boolean"},
    "concurrency": {"type": "integer", "minimum": 0},
    "lcf_buckets_aggregation_limit": {"type": "integer", "minimum": 0},
    "max_rare_negative_conditions": {"type": "integer", "minimum": 0}
  },
  "additionalProperties": false,
  "required": ["name", "driver", "parameters", "tables"],
  "definitions": {
    "table": {
      "type": "object",
      "properties": {
        "db_name": {"type": "string", "minLength": 1},
        "user_id": {
          "oneOf": [
            {"type": "string", "minLength": 1},
            { "type": "null" }
          ]
        },
        "content_type": {"type": "string", "enum": ["general", "public", "private", "individual"]},
        "keys": {"type": "array", "items": {"type": "object"}},
        "ignore_unsupported_types": {"type": "boolean", "$comment": "allowed for backward compatibility"},
        "sample_rate": {"type": "integer", "minimum": 1, "maximum": 100},
        "name": {"type": "string", "minLength": 1, "$comment": "allowed for backward compatibility"},
        "row_id": {"type": "string", "minLength": 1, "$comment": "allowed for backward compatibility"},
        "projection": {"$ref": "#/definitions/projection"},
        "decoders": {"type": "array", "items": {"$ref": "#/definitions/decoder"}},
        "query": {"type": "string", "minLength": 1},
        "auto_isolating_column_classification": {"type": "boolean"},
        "maintain_shadow_db": {"type": "boolean"},
        "isolating_columns": {"type": "object", "patternProperties": {"^.*$": {"type": "boolean"}}}
      },
      "additionalProperties": false,
      "oneOf": [
        {"required": ["user_id"]},
        {"required": ["projection"]},
        {"required": ["keys"]}
      ]
    },
    "parameters": {
      "type": "object",
      "properties": {
        "hostname": {"type": "string", "minLength": 1},
        "port": {"type": "integer", "minimum": 1},
        "username": {"type": "string", "minLength": 1},
        "database": {"type": "string", "minLength": 1},
        "password": {"type": "string"}
      },
      "additionalProperties": true,
      "required": ["hostname"]
    },
    "projection": {
      "type": "object",
      "properties": {
        "table": {"type": "string", "minLength": 1},
        "foreign_key": {"type": "string", "minLength": 1},
        "primary_key": {"type": "string", "minLength": 1},
        "user_id_alias": {"type": "string", "minLength": 1}
      },
      "additionalProperties": false,
      "required": ["table", "foreign_key", "primary_key"]
    },
    "decoder": {
      "type": "object",
      "properties": {
        "method": {"type": "string", "minLength": 1},
        "columns": {"type": "array", "items": {"$ref": "#/definitions/column"}},
        "key": {"type": "string", "minLength": 1}
      },
      "additionalProperties": true,
      "required": ["method", "columns"]
    },
    "column": {"type": "string", "minLength": 1}
  }
}
