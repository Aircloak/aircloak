!!!
%html
  %head
    %meta{charset: "utf-8"}
    %meta{:'http-equiv' => "X-UA-Compatible", content:"IE=Edge,chrome=1"}
    %meta{name: "viewport", content: "width=device-width, initial-scale=1.0"}
    %title= content_for?(:title) ? yield(:title) : "Aircloak"
    = stylesheet_link_tag "application", media: "all", "data-turbolinks-track" => true
    = csrf_meta_tags

  %body
    .container
      .content
        .row
          .span12
            .navbar.navbar-fixed-top
              .navbar-inner
                .brand &nbsp;Aircloak admin
                - if current_user
                  %ul.nav.navbar-nav
                    -# Related to managing cloak machines and their deployment
                    %li.dropdown
                      %a.dropdown-toggle{href: "#", :'data-toggle' => "dropdown"}
                        Cloak management
                        %b.caret
                      %ul.dropdown-menu
                        %li= link_to "Analysts", analysts_path if permitted_to? :manage, :analysts
                        %li= link_to "Builds", builds_path if permitted_to? :read, :builds
                        %li= link_to "Os Tags", os_tags_path if permitted_to? :read, :os_tags
                        %li= link_to "Clusters", clusters_path if permitted_to? :manage, :clusters
                        %li= link_to "Cloaks", cloaks_path if permitted_to? :manage, :cloaks
                        %li= link_to "Deployable entities", deployable_entities_path if permitted_to? :read, :deployable_entities
                        %li= link_to "Version tests", version_tests_path if permitted_to? :manage, :version_tests
                    -# Related to managing queries
                    %li.dropdown
                      %a.dropdown-toggle{href: "#", :'data-toggle' => "dropdown"}
                        Task management
                        %b.caret
                      %ul.dropdown-menu
                        %li= link_to "Tasks", tasks_path if permitted_to? :read, :tasks
                        %li= link_to "Results", results_path if permitted_to? :read, :results
                        %li= link_to "Tables", tables_path if permitted_to? :manage, :tables
                    -# Related to managing client binaries for windows machines, etc
                    %li.dropdown
                      %a.dropdown-toggle{href: "#", :'data-toggle' => "dropdown"}
                        Windows client
                        %b.caret
                      %ul.dropdown-menu
                        %li= link_to "Client binaries", client_binaries_path if permitted_to? :read, :client_binaries
                        %li= link_to "Existing commands", commands_path if permitted_to? :read, :commands
                        %li= link_to "Staging machines", staging_machines_path if permitted_to? :manage, :staging_machines
                        %li= link_to "Deployment groups", deployment_groups_path if permitted_to? :manage, :deployment_groups
                    - # Related to graphite stats
                    %li= link_to "Monitoring", metrics_path if permitted_to? :manage, :metrics
                    -# Related to user administration
                    %li.dropdown
                      %a.dropdown-toggle{href: "#", :'data-toggle' => "dropdown"}
                        User administration
                        %b.caret
                      %ul.dropdown-menu
                        %li= link_to "Users", users_path if permitted_to? :manage, :users
                        %li= link_to "Permissions", permissions_path if permitted_to? :manage, :permissions

                %ul.nav.pull-right
                  - if current_user
                    %li= link_to "Logged in as #{current_user.login}", user_path(current_user)
                    %li= link_to "Logout", logout_path
                  - else
                    %li= link_to "Login", login_path
                    %li= link_to "Register", new_user_path
          - if flash[:error]
            .alert.alert-error
              %button.close{type:"button", :'data-dismiss'=>"alert"} &times;
              = flash[:error]
          - if flash[:notice]
            .alert.alert-success
              %button.close{type:"button", :'data-dismiss'=>"alert"} &times;
              = flash[:notice]
          %div
            = yield
    = javascript_include_tag "application", "data-turbolinks-track" => true
    = yield(:javascript_include)
    = yield(:javascript)
