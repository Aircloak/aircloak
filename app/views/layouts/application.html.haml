!!!
%html
  %head
    %meta{charset: "utf-8"}
    %meta{:'http-equiv' => "X-UA-Compatible", content:"IE=Edge,chrome=1"}
    %meta{name: "viewport", content: "width=device-width, initial-scale=1.0"}
    %title= content_for?(:title) ? yield(:title) : "Aircloak"
    = stylesheet_link_tag "application", media: "all", "data-turbolinks-track" => true
    = csrf_meta_tags

  %body
    .container
      .content
        .row
          .span12
            .navbar.navbar-fixed-top
              .navbar-inner
                .brand &nbsp;Aircloak admin
                - if current_user
                  %ul.nav.navbar-nav
                    - if current_user.inquirer?
                      -# Related to managing queries
                      %li.dropdown
                        %a.dropdown-toggle{href: "#", :'data-toggle' => "dropdown"}
                          Task management
                          %b.caret
                        %ul.dropdown-menu
                          %li= link_to "Tasks", tasks_path
                          %li= link_to "Results", results_path
                          %li= link_to "Tables", tables_path
                          %li= link_to "Users", users_path

                    - if current_user.admin?
                      -# Related to managing cloak machines and their deployment
                      %li.dropdown
                        %a.dropdown-toggle{href: "#", :'data-toggle' => "dropdown"}
                          Cloak management
                          %b.caret
                        %ul.dropdown-menu
                          %li= link_to "Analysts", analysts_path
                          %li= link_to "Builds", builds_path
                          %li= link_to "Clusters", clusters_path
                          %li= link_to "Cloaks", cloaks_path
                          %li= link_to "Deployable entities", deployable_entities_path
                          %li= link_to "Version tests", version_tests_path
                      - # Related to graphite stats
                      %li= link_to "Monitoring", metrics_path
                      -# Related to user administration
                      %li.dropdown
                        %a.dropdown-toggle{href: "#", :'data-toggle' => "dropdown"}
                          User administration
                          %b.caret
                        %ul.dropdown-menu
                          %li= link_to "Users", users_path
                          %li= link_to "Permissions", permissions_path
                      -# Impersonation (one of the three unforgivable curses :|)
                      %li.dropdown
                        %a.dropdown-toggle{href: "#", :'data-toggle' => "dropdown"}
                          - if current_user.analyst
                            = "Impersonating #{current_user.analyst.name}"
                          - else
                            Impersonation
                          %b.caret
                        %ul.dropdown-menu
                          - if Analyst.count == 0
                            %li= link_to "Add an analyst", new_analyst_path
                          - else
                            - Analyst.all.each do |analyst|
                              - if current_user.analyst && current_user.analyst == analyst
                                %li= link_to "Stop impersonating #{current_user.analyst.name}",
                                    "/i_dont_want_to_be_an_imposter"
                              - else
                                %li= link_to "#{analyst.name}", "/impersonate/#{analyst.id}"

                %ul.nav.pull-right
                  - if current_user
                    %li= link_to "Logged in as #{current_user.login}", user_path(current_user)
                    %li= link_to "Logout", logout_path
                  - else
                    %li= link_to "Login", login_path
          - if flash[:error]
            .alert.alert-error
              %button.close{type:"button", :'data-dismiss'=>"alert"} &times;
              = flash[:error]
          - if flash[:notice]
            .alert.alert-success
              %button.close{type:"button", :'data-dismiss'=>"alert"} &times;
              = flash[:notice]
          %div
            = yield
    = javascript_include_tag "application", "data-turbolinks-track" => true
    = yield(:javascript_include)
    = yield(:javascript)
