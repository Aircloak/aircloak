= help_link ['managing-data', 'introduction-uploading-data']

%h3 User tables

%hr

- unless @has_tables
  %strong No tables exist yet
- else
  - @clusters.each do |cluster|
    %h2= cluster.name if current_user.has_multiple_clusters?

    %table.table.table-striped
      %thead
        %tr
          %th Name
          %th
      %tbody
        - if @tables[cluster.id]
          - @tables[cluster.id].each do |table|
            %tr
              %td= table.table_name
              %td
                - if table.pending_migrations?
                  pending migration
                  = link_to 'Retry', retry_migration_user_table_path(table), method: :post, class: "btn btn-mini"
                - else
                  = link_to 'Show', user_table_path(table)
                  \|
                  = link_to 'Edit', edit_user_table_path(table)
                  \|
                  = link_to 'Clear data', clear_user_table_path(table),  :method => :post,  class: "btn btn-mini btn-danger",
                      :data => { :confirm => 'Are you sure you want to clear all uploaded user data? This operation cannot be reversed' }
                  \|
                  = link_to 'Drop', user_table_path(table), :method => :delete, class: "btn btn-mini btn-danger",
                      :data => { :confirm => 'Are you sure you want to drop this table? This operation cannot be reversed' }
        - else
          %tr
            %td{colspan: 2}= "No tables in #{cluster.name} cluster"

= link_to "Create a new table", new_user_table_path
