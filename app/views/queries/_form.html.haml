= form_for @query do |f|
  - if @query.errors.any?
    #error_explanation
      %h2= "#{pluralize(@query.errors.count, "error")} prohibited this query from being saved:"
      %ul
        - @query.errors.full_messages.each do |msg|
          %li= msg

  .control-group
    %label.control-label Name
    .controls
      = f.text_field :name
    %label.control-label Task
    .controls
      = f.select :task_id, Task.where(ready: true).map {|task| [task.main_package, task.id]}
    %label.control-label Cluster
    .controls
      - clusters = ClusterCloak.where(raw_state: 2).map {|cc| cc.cluster }
      - sorted_cluster = clusters.sort { |a, b| a.name <=> b.name }
      - uniq_cluster = sorted_cluster.uniq { |cluster| cluster.name }
      = f.select :cluster_id, clusters.map {|cluster| [cluster.name, cluster.id]}

  .control-group
    .controls
      = f.submit 'Save', class: "btn"
