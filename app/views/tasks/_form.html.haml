-# Includes additional, page-specific javascripts
= content_for(:javascript_include) {javascript_include_tag "tasks/main", "data-turbolinks-track" => true}
= content_for :javascript do
  :coffeescript
    $(document).ready ->
      new Tasks.Editor(#{@tables_json}, #{PrefetchFilter::OperatorSqlToCloak.to_json})

.form-container
  = form_for @task, :html => {:id => "taskEditor", :class => "form-horizontal new_query"} do |f|
    - if @task.errors.any?
      .well.alert-error
        %h3= "#{pluralize(@task.errors.count, "error")} prohibited this task from being saved:"
        %ul
          - @task.errors.full_messages.each do |msg|
            %li= msg

    .control-group
      %label.control-label
        Task name
        = help_tooltip "name"
      .controls
        = f.text_field :name
    - if current_user.has_multiple_clusters?
      .control-group
        %label.control-label
          Belongs to cluster
          = help_tooltip "cluster_select"
        .controls
          = f.select :cluster_id, current_user.ready_clusters.map {|cluster| [cluster.name, cluster.id]}
    - else
      = hidden_field_tag "task[cluster_id]", current_user.ready_clusters.first.id

    .control-group
      %label.control-label
        Data
        = help_tooltip "data"
      .controls
        = f.hidden_field :data
        #prefetchTables
    .control-group
      %label.control-label
        Code
        = help_tooltip "code"
      .controls
        = f.text_area :code
    .control-group
      .controls
        = f.submit 'Save', :class => "btn btn-success"
