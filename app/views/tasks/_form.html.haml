-# Includes additional, page-specific javascripts
= content_for(:javascript_include) {javascript_include_tag "tasks", "data-turbolinks-track" => true}

.form-container{:"ng-app" => "taskEditor", :"ng-controller" => "TaskEditorCtrl"}
  = form_for @task, :html => {:class => "form-horizontal new_query"} do |f|
    - if @task.errors.any?
      .well.alert-error
        %h3= "#{pluralize(@task.errors.count, "error")} prohibited this task from being saved:"
        %ul
          - @task.errors.full_messages.each do |msg|
            %li= msg

    .control-group
      %label.control-label Task name
      .controls
        = f.text_field :name
    .control-group
      %label.control-label Belongs to cluster
      .controls
        = f.select :cluster_id, Cluster.ready_clusters.map {|cluster| [cluster.name, cluster.id]}
    .control-group
      %label.control-label Task type
      .controls
        %label.radio
          = f.radio_button :update_task, "true"
          Update
        %label.radio
          = f.radio_button :update_task, "false"
          Query
    .control-group
      %label.control-label Execution type
      .controls
        %label.radio
          = f.radio_button :stored_task, "true", :"ng-model" => "stored_task"
          Stream (stored in the cloak to be run on updates from clients)
        %label.radio
          = f.radio_button :stored_task, "false", :"ng-model" => "stored_task"
          Batch (run on request)
      .controls{:"ng-class" => "{hidden: stored_task != 'true'}"}
        %label.text_field
          = f.text_field :payload_identifier
    .control-group
      %label.control-label Code
      .controls
        = f.text_area :code

    .control-group
      .controls
        = f.submit 'Save', :class => "btn btn-success"
