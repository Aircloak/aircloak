location / {
  client_max_body_size 4G;

  proxy_read_timeout 150s;

  include /etc/nginx/support/proxy_headers.conf;
  proxy_pass http://frontend;
}

location /backend {
  include /etc/nginx/support/proxy_headers.conf;
  proxy_pass http://backend/backend/;
}

# API calls are not allowed through this site.
# Neither API calls to the public, nor to the
# infrastructure API. The reason is that API access
# is restricted through client certificates which
# are enforced at the level of nginx, and not in
# the rails site. Therefore letting them through here
# would be the same as enabling un-authenticated
# API access.

## Until manny-air has been updated to use client-certs
## It needs this end-point to be available to function
# location /api/ {
#  return 403;
# }

location /infrastructure-api/ {
  return 403;
}

# Proxies render graph request to the graphite server
location /metrics/render_graph {
  include /etc/nginx/support/proxy_headers.conf;
  proxy_pass http://cloakmetrics.mpi-sws.org/render;
}